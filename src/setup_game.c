#include "../inc/setup_game.h"
#include "../inc/sprite.h"
#include "../inc/graphic.h"
#include "../inc/draw.h"
#include "../inc/rtc.h"

//Vari√°veis globais
state_game game_state;

extern rtc_time game_clock;
char map[15][20];
extern bool change_vram_mode;
extern uint8_t using_db;

int countMonster;
int countUpMonster;
int countLife;
GamePos arrow_position;
GamePos clock_position = {9,0};
GamePos hero_position;
GamePos life_position;
GamePos bomb_position;
GamePos unlimited_bomb_position[10];
GamePos monster_position[5];
GamePos upgraded_monster_position[1];
int count_unlimited_bombs;
bool unlimited_bombs;
state_bomb bomb_state;
int helper_unlimited;
state_bomb unlimited_bombs_state[10];
int explosion_time;

int start_menu(){

  create_sprites_menu();

  if(draw_menu()) return 1;
  using_db = FALSE;
  if(draw_menu()) return 1;
  create_clock();

  return 0;
}

int start_game(){
  
  arrow_position.x = 4;
  arrow_position.y = 7;
  hero_position.x = 1;
  hero_position.y = 2;

  life_position.x = 1;
  life_position.y = 0;

  bomb_position.y = 0;
  bomb_position.x = 0;
  bomb_state = NO_BOMB;
  count_unlimited_bombs = 1;
  unlimited_bombs = false;
  helper_unlimited = 0;
  countMonster = 5;
  countUpMonster = 1;
  countLife = 2;
  explosion_time = 0;
 
  state_bomb unlimited_bombs_state_cpy[10] = {NO_BOMB,NO_BOMB,NO_BOMB,NO_BOMB,NO_BOMB,NO_BOMB,NO_BOMB,NO_BOMB,NO_BOMB,NO_BOMB};
  GamePos unlimited_bomb_position_cpy[10] = {{0,0},{0,0},{0,0},{0,0},{0,0},{0,0},{0,0},{0,0},{0,0},{0,0}};
  
  
  for(int i=0; i < 9; i++){
    unlimited_bombs_state[i] = unlimited_bombs_state_cpy[i];
    unlimited_bomb_position[i] = unlimited_bomb_position_cpy[i];
  }

  create_sprites_game();

  if(game_clock.hours < 8){
    char temp_map[15][20] = 
  {{'-','H','H','H','-','-','-','-','-','-','-','-','-','-','-','-','-','-','-','-'},
  {'#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#'},
  {'#',' ',' ',' ',' ',' ','%','%',' ','%','%',' ','%','%','M',' ',' ',' ',' ','#'},
  {'#',' ',' ','#','#','%','%','#','#',' ',' ',' ','#','#','%','%','#','#','%','#'},
  {'#','%','%','#','#',' ',' ','#','#',' ','%','%','#','#',' ',' ','#','#','%','#'},
  {'#','%','%',' ',' ','S',' ',' ',' ',' ','%','%',' ',' ',' ',' ',' ',' ',' ','#'},
  {'#',' ',' ','#','#','%','%','#','#',' ',' ',' ','#','#','%','%','#','#',' ','#'},
  {'#',' ',' ','#','#',' ',' ','#','#','M',' ',' ','#','#','%',' ','#','#',' ','#'},
  {'#','%','%','%',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','%',' ',' ',' ',' ','#'},
  {'#',' ',' ','#','#','%','%','#','#',' ',' ','U','#','#','%','%','%','%',' ','#'},
  {'#','%','%','#','#',' ',' ','#','#','%','%',' ','%','%',' ','M','%','%',' ','#'},
  {'#','%','%',' ',' ','M',' ','%','%',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','#'},
  {'#',' ',' ','#','#','%',' ','#','#','%','%',' ','#','#','%',' ','#','#',' ','#'},
  {'#',' ',' ','#','#',' ','M','#','#',' ',' ',' ','#','#',' ','%','#','#',' ','#'},
  {'#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#'}};
  memcpy(map, temp_map, sizeof(temp_map));
  }else if(game_clock.hours < 16){
    char temp_map[15][20] = 
  {{'-','H','H','H','-','-','-','-','-','-','-','-','-','-','-','-','-','-','-','-'},
  {'#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#'},
  {'#',' ',' ','M',' ',' ','%','%',' ',' ',' ',' ','%','%',' ',' ',' ',' ',' ','#'},
  {'#',' ',' ','#','#','%','%','#','#',' ',' ',' ','#','#','%','%','#','#',' ','#'},
  {'#','%','%','#','#',' ',' ','#','#',' ','%','%','#','#',' ',' ','#','#',' ','#'},
  {'#','%','%',' ',' ',' ',' ',' ',' ',' ','%','%',' ',' ',' ',' ',' ',' ','%','#'},
  {'#',' ','U','#','#','%','%','#','#',' ',' ',' ','#','#','%','%','#','#',' ','#'},
  {'#',' ',' ','#','#',' ',' ','#','#','M',' ',' ','#','#',' ',' ','#','#',' ','#'},
  {'#','%','%','%',' ',' ',' ','S',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','%','#'},
  {'#',' ',' ','#','#','%','%','#','#',' ',' ',' ','#','#','%','%','#','#',' ','#'},
  {'#','%','%','#','#',' ',' ','#','#','%','%',' ','#','#',' ','M','#','#',' ','#'},
  {'#','%','%',' ',' ',' ',' ','%','%',' ',' ',' ',' ',' ',' ',' ',' ',' ','%','#'},
  {'#',' ',' ','#','#','%','%','#','#','%','%',' ','#','#','%','%','#','#',' ','#'},
  {'#','M',' ','#','#',' ','M','#','#',' ',' ',' ','#','#',' ',' ','#','#',' ','#'},
  {'#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#'}};
  memcpy(map, temp_map, sizeof(temp_map));
  } else {
    char temp_map[15][20]  = 
  {{'-','H','H','H','-','-','-','-','-','-','-','-','-','-','-','-','-','-','-','-'},
  {'#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#'},
  {'#',' ',' ','M',' ',' ','%','%',' ',' ',' ',' ','%','%',' ',' ',' ',' ',' ','#'},
  {'#',' ',' ','#','#','%','%','#','#',' ',' ',' ','#','#','%','%','#','#',' ','#'},
  {'#','%','%','#','#',' ',' ','#','#',' ','%','%','#','#',' ',' ','#','#',' ','#'},
  {'#','%','%',' ',' ',' ',' ',' ',' ',' ',' ','U',' ',' ',' ',' ',' ',' ','%','#'},
  {'#',' ',' ','#','#','%','%','#','#',' ','#',' ','#',' ','%','%','#','#',' ','#'},
  {'#',' ',' ','#','#',' ',' ','#','#','M','#',' ','#',' ','%',' ','#','#',' ','#'},
  {'#','%','%','%',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','%',' ',' ',' ','%','#'},
  {'#',' ',' ','#','#','%','%','#','#',' ','#',' ','#',' ','%','%','#','#',' ','#'},
  {'#','%','%','#','#',' ',' ','#','#','%','%',' ','%',' ',' ',' ','#','#',' ','#'},
  {'#','%','%',' ',' ',' ',' ','%','%',' ','%',' ','%',' ',' ',' ',' ','M','%','#'},
  {'#',' ',' ','#','#','%','%','#','#','%','%',' ','%',' ','%','%','#','#',' ','#'},
  {'#','M',' ','#','#',' ','M','#','#',' ','%','S','%',' ',' ',' ','#','#',' ','#'},
  {'#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#'}};
  memcpy(map, temp_map, sizeof(temp_map));
  }


  if(draw_map()) return 1;
  using_db = FALSE;
  if(draw_map()) return 1;
  if(arrow_draw()) return 1;
  game_state = GAME;
  if(create_clock()) return 1;

  return 0;
}
