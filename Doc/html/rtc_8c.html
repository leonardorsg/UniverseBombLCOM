<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Universe Bomb: src/rtc.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">Universe Bomb<span id="projectnumber">&#160;1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search',false);
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">rtc.c File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="rtc_8h_source.html">../inc/rtc.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="timer_8h_source.html">../inc/timer.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab832160971533b0b461a1ccdb78a7b61" id="r_ab832160971533b0b461a1ccdb78a7b61"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab832160971533b0b461a1ccdb78a7b61">rtc_subscribe</a> (uint8_t *bit_no)</td></tr>
<tr class="memdesc:ab832160971533b0b461a1ccdb78a7b61"><td class="mdescLeft">&#160;</td><td class="mdescRight">Subscribes and enables RTC interrupts.  <br /></td></tr>
<tr class="separator:ab832160971533b0b461a1ccdb78a7b61"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ee1ffb1e38bc735ccf645370fe5b573" id="r_a8ee1ffb1e38bc735ccf645370fe5b573"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8ee1ffb1e38bc735ccf645370fe5b573">rtc_unsubscribe</a> ()</td></tr>
<tr class="memdesc:a8ee1ffb1e38bc735ccf645370fe5b573"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unsubscribes RTC interrupts.  <br /></td></tr>
<tr class="separator:a8ee1ffb1e38bc735ccf645370fe5b573"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ed1aa674529e023d301426a61e068ec" id="r_a2ed1aa674529e023d301426a61e068ec"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2ed1aa674529e023d301426a61e068ec">read_rtc</a> (uint8_t command, uint8_t *output)</td></tr>
<tr class="memdesc:a2ed1aa674529e023d301426a61e068ec"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads the rtc answer to a given command.  <br /></td></tr>
<tr class="separator:a2ed1aa674529e023d301426a61e068ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8758c2007483eff1e5552b63969c96f1" id="r_a8758c2007483eff1e5552b63969c96f1"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8758c2007483eff1e5552b63969c96f1">binary_number</a> (uint8_t n)</td></tr>
<tr class="separator:a8758c2007483eff1e5552b63969c96f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3403a6bc09cef97388f90187af8605bd" id="r_a3403a6bc09cef97388f90187af8605bd"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3403a6bc09cef97388f90187af8605bd">conversion</a> ()</td></tr>
<tr class="memdesc:a3403a6bc09cef97388f90187af8605bd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert the unit of time being used by the rtc to a binary number.  <br /></td></tr>
<tr class="separator:a3403a6bc09cef97388f90187af8605bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a92c77cd7d27c71e3e8aa7acd14c6d996" id="r_a92c77cd7d27c71e3e8aa7acd14c6d996"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a92c77cd7d27c71e3e8aa7acd14c6d996">update_rtc_time</a> (<a class="el" href="structrtc__time.html">rtc_time</a> *clocking)</td></tr>
<tr class="memdesc:a92c77cd7d27c71e3e8aa7acd14c6d996"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads each current time unit from the rtc and stores it in a struct.  <br /></td></tr>
<tr class="separator:a92c77cd7d27c71e3e8aa7acd14c6d996"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75dad42881d64cf07cf1bdc2979a7056" id="r_a75dad42881d64cf07cf1bdc2979a7056"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a75dad42881d64cf07cf1bdc2979a7056">rtc_ih</a> ()</td></tr>
<tr class="memdesc:a75dad42881d64cf07cf1bdc2979a7056"><td class="mdescLeft">&#160;</td><td class="mdescRight">Updates the rtc time.  <br /></td></tr>
<tr class="separator:a75dad42881d64cf07cf1bdc2979a7056"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:abdd2eef1d70041de463214f2f9469f4d" id="r_abdd2eef1d70041de463214f2f9469f4d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abdd2eef1d70041de463214f2f9469f4d">counter_timer</a></td></tr>
<tr class="separator:abdd2eef1d70041de463214f2f9469f4d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c52a1d32571a429369253ce7c3a3d7a" id="r_a6c52a1d32571a429369253ce7c3a3d7a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6c52a1d32571a429369253ce7c3a3d7a">rtc_hook_id</a> = 5</td></tr>
<tr class="separator:a6c52a1d32571a429369253ce7c3a3d7a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a28e057c30e663aaf6378bc4cb8a7a97d" id="r_a28e057c30e663aaf6378bc4cb8a7a97d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a28e057c30e663aaf6378bc4cb8a7a97d">read_constant_info</a> = 1</td></tr>
<tr class="separator:a28e057c30e663aaf6378bc4cb8a7a97d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a91552a8a8057879c17db3a7085b4e725" id="r_a91552a8a8057879c17db3a7085b4e725"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structrtc__time.html">rtc_time</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a91552a8a8057879c17db3a7085b4e725">game_clock</a></td></tr>
<tr class="separator:a91552a8a8057879c17db3a7085b4e725"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a8758c2007483eff1e5552b63969c96f1" name="a8758c2007483eff1e5552b63969c96f1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8758c2007483eff1e5552b63969c96f1">&#9670;&#160;</a></span>binary_number()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t binary_number </td>
          <td>(</td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>n</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   28</span>                                 {</div>
<div class="line"><span class="lineno">   29</span>    <span class="keywordflow">return</span> ((n &gt;&gt; 4) * 10) + (n &amp; 0xF);</div>
<div class="line"><span class="lineno">   30</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a3403a6bc09cef97388f90187af8605bd" name="a3403a6bc09cef97388f90187af8605bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3403a6bc09cef97388f90187af8605bd">&#9670;&#160;</a></span>conversion()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int conversion </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convert the unit of time being used by the rtc to a binary number. </p>
<p>First, sends a command to the rtc to know which unit of time is being (binary or BCD). If is BCD, convert to binary.</p>
<dl class="section return"><dt>Returns</dt><dd>Return 0 upon success and non-zero otherwise </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">   32</span>                  {</div>
<div class="line"><span class="lineno">   33</span>    uint8_t st;</div>
<div class="line"><span class="lineno">   34</span>    <span class="keywordflow">if</span>(<a class="code hl_function" href="#a2ed1aa674529e023d301426a61e068ec">read_rtc</a>(<a class="code hl_define" href="rtc_8h.html#a5b66522878a03d15799e8674b596e501">COUNT_ST_COMMAND</a>,&amp;st)) <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">   35</span>    <span class="keywordflow">if</span>(st &amp; <a class="code hl_define" href="video_8h.html#a3a8ea58898cb58fc96013383d39f482c">BIT</a>(2)) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">   36</span> </div>
<div class="line"><span class="lineno">   37</span>    <a class="code hl_variable" href="#a91552a8a8057879c17db3a7085b4e725">game_clock</a>.<a class="code hl_variable" href="structrtc__time.html#a46729a903be1a03cdb248fb48d84d4f5">seconds</a> = <a class="code hl_function" href="#a8758c2007483eff1e5552b63969c96f1">binary_number</a>(<a class="code hl_variable" href="#a91552a8a8057879c17db3a7085b4e725">game_clock</a>.<a class="code hl_variable" href="structrtc__time.html#a46729a903be1a03cdb248fb48d84d4f5">seconds</a>);</div>
<div class="line"><span class="lineno">   38</span>    <a class="code hl_variable" href="#a91552a8a8057879c17db3a7085b4e725">game_clock</a>.<a class="code hl_variable" href="structrtc__time.html#a7acca8be0094a19be6e308ac05924c4f">minutes</a> = <a class="code hl_function" href="#a8758c2007483eff1e5552b63969c96f1">binary_number</a>(<a class="code hl_variable" href="#a91552a8a8057879c17db3a7085b4e725">game_clock</a>.<a class="code hl_variable" href="structrtc__time.html#a7acca8be0094a19be6e308ac05924c4f">minutes</a>);</div>
<div class="line"><span class="lineno">   39</span>    <a class="code hl_variable" href="#a91552a8a8057879c17db3a7085b4e725">game_clock</a>.<a class="code hl_variable" href="structrtc__time.html#a00a531a34a1d603329df5778f1203ab6">hours</a> = <a class="code hl_function" href="#a8758c2007483eff1e5552b63969c96f1">binary_number</a>(<a class="code hl_variable" href="#a91552a8a8057879c17db3a7085b4e725">game_clock</a>.<a class="code hl_variable" href="structrtc__time.html#a00a531a34a1d603329df5778f1203ab6">hours</a>);</div>
<div class="line"><span class="lineno">   40</span>    <a class="code hl_variable" href="#a91552a8a8057879c17db3a7085b4e725">game_clock</a>.<a class="code hl_variable" href="structrtc__time.html#aa569a2d29184e1609102fabf121f373e">days</a> = <a class="code hl_function" href="#a8758c2007483eff1e5552b63969c96f1">binary_number</a>(<a class="code hl_variable" href="#a91552a8a8057879c17db3a7085b4e725">game_clock</a>.<a class="code hl_variable" href="structrtc__time.html#aa569a2d29184e1609102fabf121f373e">days</a>);</div>
<div class="line"><span class="lineno">   41</span>    <a class="code hl_variable" href="#a91552a8a8057879c17db3a7085b4e725">game_clock</a>.<a class="code hl_variable" href="structrtc__time.html#a566c85a0048ef2b47f88710e62eae68e">months</a> = <a class="code hl_function" href="#a8758c2007483eff1e5552b63969c96f1">binary_number</a>(<a class="code hl_variable" href="#a91552a8a8057879c17db3a7085b4e725">game_clock</a>.<a class="code hl_variable" href="structrtc__time.html#a566c85a0048ef2b47f88710e62eae68e">months</a>);</div>
<div class="line"><span class="lineno">   42</span>    <a class="code hl_variable" href="#a91552a8a8057879c17db3a7085b4e725">game_clock</a>.<a class="code hl_variable" href="structrtc__time.html#af48bbd489c3b29e16919ea2a629429de">years</a> = <a class="code hl_function" href="#a8758c2007483eff1e5552b63969c96f1">binary_number</a>(<a class="code hl_variable" href="#a91552a8a8057879c17db3a7085b4e725">game_clock</a>.<a class="code hl_variable" href="structrtc__time.html#af48bbd489c3b29e16919ea2a629429de">years</a>);</div>
<div class="line"><span class="lineno">   43</span>    </div>
<div class="line"><span class="lineno">   44</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">   45</span> </div>
<div class="line"><span class="lineno">   46</span>}</div>
<div class="ttc" id="artc_8c_html_a2ed1aa674529e023d301426a61e068ec"><div class="ttname"><a href="#a2ed1aa674529e023d301426a61e068ec">read_rtc</a></div><div class="ttdeci">int read_rtc(uint8_t command, uint8_t *output)</div><div class="ttdoc">Reads the rtc answer to a given command.</div><div class="ttdef"><b>Definition</b> rtc.c:22</div></div>
<div class="ttc" id="artc_8c_html_a8758c2007483eff1e5552b63969c96f1"><div class="ttname"><a href="#a8758c2007483eff1e5552b63969c96f1">binary_number</a></div><div class="ttdeci">uint8_t binary_number(uint8_t n)</div><div class="ttdef"><b>Definition</b> rtc.c:28</div></div>
<div class="ttc" id="artc_8c_html_a91552a8a8057879c17db3a7085b4e725"><div class="ttname"><a href="#a91552a8a8057879c17db3a7085b4e725">game_clock</a></div><div class="ttdeci">rtc_time game_clock</div><div class="ttdef"><b>Definition</b> rtc.c:8</div></div>
<div class="ttc" id="artc_8h_html_a5b66522878a03d15799e8674b596e501"><div class="ttname"><a href="rtc_8h.html#a5b66522878a03d15799e8674b596e501">COUNT_ST_COMMAND</a></div><div class="ttdeci">#define COUNT_ST_COMMAND</div><div class="ttdef"><b>Definition</b> rtc.h:20</div></div>
<div class="ttc" id="astructrtc__time_html_a00a531a34a1d603329df5778f1203ab6"><div class="ttname"><a href="structrtc__time.html#a00a531a34a1d603329df5778f1203ab6">rtc_time::hours</a></div><div class="ttdeci">uint8_t hours</div><div class="ttdef"><b>Definition</b> rtc.h:27</div></div>
<div class="ttc" id="astructrtc__time_html_a46729a903be1a03cdb248fb48d84d4f5"><div class="ttname"><a href="structrtc__time.html#a46729a903be1a03cdb248fb48d84d4f5">rtc_time::seconds</a></div><div class="ttdeci">uint8_t seconds</div><div class="ttdef"><b>Definition</b> rtc.h:25</div></div>
<div class="ttc" id="astructrtc__time_html_a566c85a0048ef2b47f88710e62eae68e"><div class="ttname"><a href="structrtc__time.html#a566c85a0048ef2b47f88710e62eae68e">rtc_time::months</a></div><div class="ttdeci">uint8_t months</div><div class="ttdef"><b>Definition</b> rtc.h:29</div></div>
<div class="ttc" id="astructrtc__time_html_a7acca8be0094a19be6e308ac05924c4f"><div class="ttname"><a href="structrtc__time.html#a7acca8be0094a19be6e308ac05924c4f">rtc_time::minutes</a></div><div class="ttdeci">uint8_t minutes</div><div class="ttdef"><b>Definition</b> rtc.h:26</div></div>
<div class="ttc" id="astructrtc__time_html_aa569a2d29184e1609102fabf121f373e"><div class="ttname"><a href="structrtc__time.html#aa569a2d29184e1609102fabf121f373e">rtc_time::days</a></div><div class="ttdeci">uint8_t days</div><div class="ttdef"><b>Definition</b> rtc.h:28</div></div>
<div class="ttc" id="astructrtc__time_html_af48bbd489c3b29e16919ea2a629429de"><div class="ttname"><a href="structrtc__time.html#af48bbd489c3b29e16919ea2a629429de">rtc_time::years</a></div><div class="ttdeci">uint8_t years</div><div class="ttdef"><b>Definition</b> rtc.h:30</div></div>
<div class="ttc" id="avideo_8h_html_a3a8ea58898cb58fc96013383d39f482c"><div class="ttname"><a href="video_8h.html#a3a8ea58898cb58fc96013383d39f482c">BIT</a></div><div class="ttdeci">#define BIT(n)</div><div class="ttdef"><b>Definition</b> video.h:6</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2ed1aa674529e023d301426a61e068ec" name="a2ed1aa674529e023d301426a61e068ec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2ed1aa674529e023d301426a61e068ec">&#9670;&#160;</a></span>read_rtc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int read_rtc </td>
          <td>(</td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>command</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *</td>          <td class="paramname"><span class="paramname"><em>output</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reads the rtc answer to a given command. </p>
<p>First, sends a command to the rtc writing port, then reads what is in the output register to find out the answer</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">command</td><td>an uint8_t unit that specifies the command </td></tr>
    <tr><td class="paramname">output</td><td>an uint8_t unit that stores the rtc output</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Return 0 upon success and non-zero otherwise </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">   22</span>                                                {</div>
<div class="line"><span class="lineno">   23</span>    <span class="keywordflow">if</span>(sys_outb(<a class="code hl_define" href="rtc_8h.html#ace6092ae4f61400fb4e8493cf74232dc">WRITE_RTC_REG</a>,command)) <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">   24</span>    <span class="keywordflow">if</span>(<a class="code hl_function" href="utils_8c.html#a2b56f50ba159e9d5115ed1a75eff15d9">util_sys_inb</a>(<a class="code hl_define" href="rtc_8h.html#afaacbfa5c565eb89cc18251b51508488">READ_RTC_REG</a>,output)) <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">   25</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">   26</span>}</div>
<div class="ttc" id="artc_8h_html_ace6092ae4f61400fb4e8493cf74232dc"><div class="ttname"><a href="rtc_8h.html#ace6092ae4f61400fb4e8493cf74232dc">WRITE_RTC_REG</a></div><div class="ttdeci">#define WRITE_RTC_REG</div><div class="ttdef"><b>Definition</b> rtc.h:10</div></div>
<div class="ttc" id="artc_8h_html_afaacbfa5c565eb89cc18251b51508488"><div class="ttname"><a href="rtc_8h.html#afaacbfa5c565eb89cc18251b51508488">READ_RTC_REG</a></div><div class="ttdeci">#define READ_RTC_REG</div><div class="ttdef"><b>Definition</b> rtc.h:11</div></div>
<div class="ttc" id="autils_8c_html_a2b56f50ba159e9d5115ed1a75eff15d9"><div class="ttname"><a href="utils_8c.html#a2b56f50ba159e9d5115ed1a75eff15d9">util_sys_inb</a></div><div class="ttdeci">int util_sys_inb(int port, uint8_t *value)</div><div class="ttdef"><b>Definition</b> utils.c:21</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a75dad42881d64cf07cf1bdc2979a7056" name="a75dad42881d64cf07cf1bdc2979a7056"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a75dad42881d64cf07cf1bdc2979a7056">&#9670;&#160;</a></span>rtc_ih()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rtc_ih </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Updates the rtc time. </p>
<p>It attempts to call update_rtc_time at least 10 times passing as the parameter the game_clock, once it succeeds then converts the value to a binary number using the <a class="el" href="rtc_8h.html#a3403a6bc09cef97388f90187af8605bd" title="Convert the unit of time being used by the rtc to a binary number.">conversion()</a>. The function is called on each rtc interrupt and each timer interrupt, to ensure that the time is updated every second </p>
<div class="fragment"><div class="line"><span class="lineno">   66</span>               {</div>
<div class="line"><span class="lineno">   67</span>    <span class="keywordtype">int</span> attempts = 10;</div>
<div class="line"><span class="lineno">   68</span> </div>
<div class="line"><span class="lineno">   69</span>    <span class="keywordflow">while</span>(attempts&gt;0){</div>
<div class="line"><span class="lineno">   70</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="#a92c77cd7d27c71e3e8aa7acd14c6d996">update_rtc_time</a>(&amp;<a class="code hl_variable" href="#a91552a8a8057879c17db3a7085b4e725">game_clock</a>)) <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">   71</span>    </div>
<div class="line"><span class="lineno">   72</span>        tickdelay(micros_to_ticks(2000));</div>
<div class="line"><span class="lineno">   73</span>        attempts--;</div>
<div class="line"><span class="lineno">   74</span>    }</div>
<div class="line"><span class="lineno">   75</span>    <a class="code hl_function" href="#a3403a6bc09cef97388f90187af8605bd">conversion</a>();</div>
<div class="line"><span class="lineno">   76</span>}</div>
<div class="ttc" id="artc_8c_html_a3403a6bc09cef97388f90187af8605bd"><div class="ttname"><a href="#a3403a6bc09cef97388f90187af8605bd">conversion</a></div><div class="ttdeci">int conversion()</div><div class="ttdoc">Convert the unit of time being used by the rtc to a binary number.</div><div class="ttdef"><b>Definition</b> rtc.c:32</div></div>
<div class="ttc" id="artc_8c_html_a92c77cd7d27c71e3e8aa7acd14c6d996"><div class="ttname"><a href="#a92c77cd7d27c71e3e8aa7acd14c6d996">update_rtc_time</a></div><div class="ttdeci">int update_rtc_time(rtc_time *clocking)</div><div class="ttdoc">Reads each current time unit from the rtc and stores it in a struct.</div><div class="ttdef"><b>Definition</b> rtc.c:47</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab832160971533b0b461a1ccdb78a7b61" name="ab832160971533b0b461a1ccdb78a7b61"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab832160971533b0b461a1ccdb78a7b61">&#9670;&#160;</a></span>rtc_subscribe()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rtc_subscribe </td>
          <td>(</td>
          <td class="paramtype">uint8_t *</td>          <td class="paramname"><span class="paramname"><em>bit_no</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Subscribes and enables RTC interrupts. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">bit_no</td><td>address of memory to be initialized with the bit number to be set in the mask returned upon an interrupt</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Return 0 upon success and non-zero otherwise </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">   11</span>                                    {</div>
<div class="line"><span class="lineno">   12</span>    <span class="keywordflow">if</span>(bit_no == NULL) <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">   13</span>    *bit_no = <a class="code hl_define" href="video_8h.html#a3a8ea58898cb58fc96013383d39f482c">BIT</a>(<a class="code hl_variable" href="#a6c52a1d32571a429369253ce7c3a3d7a">rtc_hook_id</a>);</div>
<div class="line"><span class="lineno">   14</span>    <span class="keywordflow">if</span>(sys_irqsetpolicy(<a class="code hl_define" href="rtc_8h.html#a85ec75eda86e46118e4e096f23363beb">IRQ_LINE_RTC</a>, IRQ_REENABLE, &amp;<a class="code hl_variable" href="#a6c52a1d32571a429369253ce7c3a3d7a">rtc_hook_id</a>)) <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">   15</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">   16</span>}</div>
<div class="ttc" id="artc_8c_html_a6c52a1d32571a429369253ce7c3a3d7a"><div class="ttname"><a href="#a6c52a1d32571a429369253ce7c3a3d7a">rtc_hook_id</a></div><div class="ttdeci">int rtc_hook_id</div><div class="ttdef"><b>Definition</b> rtc.c:6</div></div>
<div class="ttc" id="artc_8h_html_a85ec75eda86e46118e4e096f23363beb"><div class="ttname"><a href="rtc_8h.html#a85ec75eda86e46118e4e096f23363beb">IRQ_LINE_RTC</a></div><div class="ttdeci">#define IRQ_LINE_RTC</div><div class="ttdef"><b>Definition</b> rtc.h:22</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8ee1ffb1e38bc735ccf645370fe5b573" name="a8ee1ffb1e38bc735ccf645370fe5b573"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ee1ffb1e38bc735ccf645370fe5b573">&#9670;&#160;</a></span>rtc_unsubscribe()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rtc_unsubscribe </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unsubscribes RTC interrupts. </p>
<dl class="section return"><dt>Returns</dt><dd>Return 0 upon success and non-zero otherwise </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">   17</span>                       {</div>
<div class="line"><span class="lineno">   18</span>    <span class="keywordflow">if</span>(sys_irqrmpolicy(&amp;<a class="code hl_variable" href="#a6c52a1d32571a429369253ce7c3a3d7a">rtc_hook_id</a>)) <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">   19</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">   20</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a92c77cd7d27c71e3e8aa7acd14c6d996" name="a92c77cd7d27c71e3e8aa7acd14c6d996"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a92c77cd7d27c71e3e8aa7acd14c6d996">&#9670;&#160;</a></span>update_rtc_time()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int update_rtc_time </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrtc__time.html">rtc_time</a> *</td>          <td class="paramname"><span class="paramname"><em>clocking</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reads each current time unit from the rtc and stores it in a struct. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">clocking</td><td>a <a class="el" href="structrtc__time.html">rtc_time</a> unit that stores the time from years to seconds</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Return 0 upon success and non-zero otherwise </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">   47</span>                                         {</div>
<div class="line"><span class="lineno">   48</span>    uint8_t response;</div>
<div class="line"><span class="lineno">   49</span>    <span class="keywordflow">if</span>(<a class="code hl_function" href="#a2ed1aa674529e023d301426a61e068ec">read_rtc</a>(<a class="code hl_define" href="rtc_8h.html#a0d501043341c67d60eda7ac405665ac1">SEC_COMMAND</a>,&amp;response)) <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">   50</span>    clocking-&gt;<a class="code hl_variable" href="structrtc__time.html#a46729a903be1a03cdb248fb48d84d4f5">seconds</a> = response;</div>
<div class="line"><span class="lineno">   51</span>    <span class="keywordflow">if</span>(<a class="code hl_function" href="#a2ed1aa674529e023d301426a61e068ec">read_rtc</a>(<a class="code hl_define" href="rtc_8h.html#a176cc732034053904063f9adf92718c2">MIN_COMMAND</a>,&amp;response)) <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">   52</span>    clocking-&gt;<a class="code hl_variable" href="structrtc__time.html#a7acca8be0094a19be6e308ac05924c4f">minutes</a> = response;</div>
<div class="line"><span class="lineno">   53</span>    <span class="keywordflow">if</span>(<a class="code hl_function" href="#a2ed1aa674529e023d301426a61e068ec">read_rtc</a>(<a class="code hl_define" href="rtc_8h.html#a13dbd5bf9e7bb691873aa5c2174ac60f">HOUR_COMMAND</a>,&amp;response)) <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">   54</span>    clocking-&gt;<a class="code hl_variable" href="structrtc__time.html#a00a531a34a1d603329df5778f1203ab6">hours</a> = response;</div>
<div class="line"><span class="lineno">   55</span> </div>
<div class="line"><span class="lineno">   56</span>    <span class="keywordflow">if</span>(<a class="code hl_function" href="#a2ed1aa674529e023d301426a61e068ec">read_rtc</a>(<a class="code hl_define" href="rtc_8h.html#a5d02bee5443233e53b9a6124fced0d15">DAY_COMMAND</a>,&amp;response)) <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">   57</span>    clocking-&gt;<a class="code hl_variable" href="structrtc__time.html#aa569a2d29184e1609102fabf121f373e">days</a> = response;</div>
<div class="line"><span class="lineno">   58</span>    <span class="keywordflow">if</span>(<a class="code hl_function" href="#a2ed1aa674529e023d301426a61e068ec">read_rtc</a>(<a class="code hl_define" href="rtc_8h.html#acdf44f2054e28539cc914d41e6682902">MON_COMMAND</a>,&amp;response)) <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">   59</span>    clocking-&gt;<a class="code hl_variable" href="structrtc__time.html#a566c85a0048ef2b47f88710e62eae68e">months</a> = response;</div>
<div class="line"><span class="lineno">   60</span>    <span class="keywordflow">if</span>(<a class="code hl_function" href="#a2ed1aa674529e023d301426a61e068ec">read_rtc</a>(<a class="code hl_define" href="rtc_8h.html#a66dbf99b54ae873ad082bd40893e2e56">YEAR_COMMAND</a>,&amp;response)) <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">   61</span>    clocking-&gt;<a class="code hl_variable" href="structrtc__time.html#af48bbd489c3b29e16919ea2a629429de">years</a> = response;</div>
<div class="line"><span class="lineno">   62</span> </div>
<div class="line"><span class="lineno">   63</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">   64</span>}</div>
<div class="ttc" id="artc_8h_html_a0d501043341c67d60eda7ac405665ac1"><div class="ttname"><a href="rtc_8h.html#a0d501043341c67d60eda7ac405665ac1">SEC_COMMAND</a></div><div class="ttdeci">#define SEC_COMMAND</div><div class="ttdef"><b>Definition</b> rtc.h:13</div></div>
<div class="ttc" id="artc_8h_html_a13dbd5bf9e7bb691873aa5c2174ac60f"><div class="ttname"><a href="rtc_8h.html#a13dbd5bf9e7bb691873aa5c2174ac60f">HOUR_COMMAND</a></div><div class="ttdeci">#define HOUR_COMMAND</div><div class="ttdef"><b>Definition</b> rtc.h:15</div></div>
<div class="ttc" id="artc_8h_html_a176cc732034053904063f9adf92718c2"><div class="ttname"><a href="rtc_8h.html#a176cc732034053904063f9adf92718c2">MIN_COMMAND</a></div><div class="ttdeci">#define MIN_COMMAND</div><div class="ttdef"><b>Definition</b> rtc.h:14</div></div>
<div class="ttc" id="artc_8h_html_a5d02bee5443233e53b9a6124fced0d15"><div class="ttname"><a href="rtc_8h.html#a5d02bee5443233e53b9a6124fced0d15">DAY_COMMAND</a></div><div class="ttdeci">#define DAY_COMMAND</div><div class="ttdef"><b>Definition</b> rtc.h:16</div></div>
<div class="ttc" id="artc_8h_html_a66dbf99b54ae873ad082bd40893e2e56"><div class="ttname"><a href="rtc_8h.html#a66dbf99b54ae873ad082bd40893e2e56">YEAR_COMMAND</a></div><div class="ttdeci">#define YEAR_COMMAND</div><div class="ttdef"><b>Definition</b> rtc.h:18</div></div>
<div class="ttc" id="artc_8h_html_acdf44f2054e28539cc914d41e6682902"><div class="ttname"><a href="rtc_8h.html#acdf44f2054e28539cc914d41e6682902">MON_COMMAND</a></div><div class="ttdeci">#define MON_COMMAND</div><div class="ttdef"><b>Definition</b> rtc.h:17</div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="abdd2eef1d70041de463214f2f9469f4d" name="abdd2eef1d70041de463214f2f9469f4d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abdd2eef1d70041de463214f2f9469f4d">&#9670;&#160;</a></span>counter_timer</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int counter_timer</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a91552a8a8057879c17db3a7085b4e725" name="a91552a8a8057879c17db3a7085b4e725"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a91552a8a8057879c17db3a7085b4e725">&#9670;&#160;</a></span>game_clock</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structrtc__time.html">rtc_time</a> game_clock</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a28e057c30e663aaf6378bc4cb8a7a97d" name="a28e057c30e663aaf6378bc4cb8a7a97d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a28e057c30e663aaf6378bc4cb8a7a97d">&#9670;&#160;</a></span>read_constant_info</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int read_constant_info = 1</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a6c52a1d32571a429369253ce7c3a3d7a" name="a6c52a1d32571a429369253ce7c3a3d7a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6c52a1d32571a429369253ce7c3a3d7a">&#9670;&#160;</a></span>rtc_hook_id</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rtc_hook_id = 5</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.11.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
